import React, { useState, useEffect, useMemo } from 'react';
import { 
  Calendar, 
  Calculator, 
  Upload, 
  Search, 
  AlertCircle, 
  CheckCircle, 
  ExternalLink, 
  MessageCircle, 
  ChevronDown, 
  ChevronUp, 
  Users, 
  ArrowLeft, 
  Info, 
  ShieldAlert, 
  XCircle, 
  Globe, 
  ArrowRight, 
  Download,
  FileText
} from 'lucide-react';

// --- Data Definitions ---
const ATTACHMENT_DATA = [
  { category: 'ì¸ì ê³µì œ', item: 'ë¶€ì–‘ê°€ì¡± ì¦ëª…', docs: 'ì£¼ë¯¼ë“±ë¡í‘œë“±ë³¸, ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ', issue: 'ì£¼ë¯¼ì„¼í„°', note: '' },
  { category: 'ì£¼íƒìê¸ˆ', item: 'ì¥ê¸°ì£¼íƒì €ë‹¹ì°¨ì…ê¸ˆ', docs: 'ì´ììƒí™˜ì¦ëª…ì„œ, ë“±ê¸°ë¶€ë“±ë³¸ ë“±', issue: 'ê¸ˆìœµì‚¬, ë“±ê¸°ì†Œ', note: 'êµ­ì„¸ì²­ ê°„ì†Œí™” í™•ì¸' },
  { category: 'ì˜ë£Œë¹„', item: 'ì•ˆê²½/ì½˜íƒíŠ¸ë Œì¦ˆ', docs: 'ì‹œë ¥êµì •ìš© ì˜ìˆ˜ì¦', issue: 'ì•ˆê²½ì ', note: '1ì¸ë‹¹ 50ë§Œì› í•œë„' },
  { category: 'êµìœ¡ë¹„', item: 'êµë³µ êµ¬ì…ë¹„', docs: 'êµìœ¡ë¹„ë‚©ì…ì¦ëª…ì„œ', issue: 'êµë³µíŒë§¤ì²˜', note: '1ì¸ë‹¹ 50ë§Œì› í•œë„' },
];

const CAUTION_ITEMS = [
  { id: 'c1', category: 'caution', title: 'ë‚˜ì´ìŠ¤ ì¸ì  ê³µì œ ì‘ì„±', limit: 'ë¹„êµ í™•ì¸ í•„ìˆ˜', desc: 'ë‚˜ì´ìŠ¤ì— 2024ë…„ ì‹ ê³  ë‚´ìš©ê³¼ ë°˜ë“œì‹œ ë¹„êµí•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”. í™”ë©´ ìƒë‹¨ ë“œëë°•ìŠ¤ì—ì„œ 2024ë¥¼ ì„ íƒí•´ ëŒ€ì¡°í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.' },
  { id: 'c2', category: 'caution', title: 'ì•ˆê²½ ê³µì œ ìˆ˜ê¸° ì •ì •', limit: '1ì¸ë‹¹ 50ë§Œì› í•œë„', desc: 'ì•ˆê²½Â·ì½˜íƒíŠ¸ë Œì¦ˆ êµ¬ì…ë¹„ìš© ì¤‘ 50ë§Œì›ì„ ì´ˆê³¼í•˜ëŠ” ê¸ˆì•¡ì´ ìˆë‹¤ë©´, ë‚˜ì´ìŠ¤ ì‹œìŠ¤í…œì—ì„œ ì§ì ‘ ìˆ˜ê¸° ì •ì •í•´ì•¼ í•©ë‹ˆë‹¤.' },
  { id: 'c3', category: 'caution', title: 'ì¥ê¸°ì£¼íƒì €ë‹¹ì°¨ì…ê¸ˆ ì´ì', limit: 'ì œì¶œì„œë¥˜ ë³µì¡', desc: 'êµ¬ë§¤ë‹¹ì‹œ ê³µë™/ê°œë³„ ì£¼íƒ ê°€ê²© í™•ì¸ì„œ ì œì¶œì´ í•„ìˆ˜ì…ë‹ˆë‹¤. ê³µë™ì£¼íƒê°€ê²©í™•ì¸ì„œëŠ” ì¸í„°ë„· ë°œê¸‰ì´ ë¶ˆê°€í•˜ë©° ë³¸ì¸ë§Œ ë°œê¸‰ ê°€ëŠ¥í•˜ë‹ˆ ë¯¸ë¦¬ ì¤€ë¹„í•˜ì„¸ìš”.' },
  { id: 'c4', category: 'caution', title: 'ê°œì‚°ê¸‰ ì‚¬ìš©ì ì£¼ì˜ì‚¬í•­', limit: 'ì¹´ë“œ ê³µì œ ì œì™¸', desc: 'ì¹´ë“œ ì´ìš© ê¸ˆì•¡ ì¤‘ ê°œì‚°ê¸‰(ì—¬ë¹„ ë“±)ìœ¼ë¡œ ì‚¬ìš©í•œ ê¸ˆì•¡ì€ ì†Œë“ê³µì œ ëŒ€ìƒì—ì„œ ë°˜ë“œì‹œ ì œì™¸í•´ì•¼ í•©ë‹ˆë‹¤.' },
  { id: 'c5', category: 'caution', title: 'ì‹¤ì†ì˜ë£Œë³´í—˜ê¸ˆ ìˆ˜ë ¹ì•¡', limit: 'ì´ì¤‘ê³µì œ ë¶ˆê°€', desc: 'ë³¸ì¸ ë° ë¶€ì–‘ê°€ì¡± ëª…ì˜ì˜ ì‹¤ì†ë³´í—˜ê¸ˆ ìˆ˜ë ¹ì•¡ì€ ì˜ë£Œë¹„ ì§€ì¶œì•¡ì—ì„œ ë°˜ë“œì‹œ ì°¨ê°í•´ì•¼ í•©ë‹ˆë‹¤.' },
  { id: 'c6', category: 'caution', title: 'ë¶€ë…€ì ê³µì œ ìš”ê±´', limit: 'ì—° 50ë§Œì›', desc: 'ì´ê¸‰ì—¬ 7,000ë§Œì› ì´í•˜ì¼ ë•Œë§Œ ê°€ëŠ¥í•˜ë©°, ë°°ìš°ì ìœ ë¬´ì™€ ë¶€ì–‘ê°€ì¡± ìš”ê±´ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.' },
];

const GENERAL_DEDUCTIONS = [
  { id: 'd1', category: 'human', title: 'ê¸°ë³¸ ê³µì œ', limit: '1ì¸ë‹¹ 150ë§Œì›', desc: 'ë³¸ì¸, ë°°ìš°ì, ë¶€ì–‘ê°€ì¡±(ì†Œë“ 100ë§Œ ì´í•˜ & ë‚˜ì´ìš”ê±´ ì¶©ì¡± ì‹œ)' },
  { id: 'd2', category: 'money', title: 'ì‹ ìš©ì¹´ë“œ ë“± ê³µì œ', limit: 'ì´ê¸‰ì—¬ 25% ì´ˆê³¼ë¶„ì˜ 15~40%', desc: 'í˜„ê¸ˆì˜ìˆ˜ì¦, ì „í†µì‹œì¥, ëŒ€ì¤‘êµí†µ ì´ìš© ì‹œ ìœ ë¦¬í•©ë‹ˆë‹¤.' },
  { id: 'd3', category: 'money', title: 'ì²´ë ¥ë‹¨ë ¨ì¥ ì´ìš©ë£Œ', limit: '30% ì„¸ì•¡ê³µì œ', desc: '2025ë…„ ì‹ ì„¤: ìˆ˜ì˜ì¥, í—¬ìŠ¤ì¥ ì§€ì¶œë¶„ ëŒ€ìƒ' },
  { id: 'd4', category: 'special', title: 'ì˜ë£Œë¹„ ì„¸ì•¡ê³µì œ', limit: 'ì´ê¸‰ì—¬ 3% ì´ˆê³¼ë¶„', desc: 'ë³¸ì¸ ë° ë¶€ì–‘ê°€ì¡±ì„ ìœ„í•´ ì§€ì¶œí•œ ì˜ë£Œë¹„ ëŒ€ìƒ' },
  { id: 'd5', category: 'house', title: 'ì›”ì„¸ ì„¸ì•¡ê³µì œ', limit: 'ì—° 1,000ë§Œì› í•œë„', desc: 'ë¬´ì£¼íƒ ì„¸ëŒ€ì£¼ë¡œì„œ ì „ì…ì‹ ê³ ê°€ ì™„ë£Œëœ ì£¼íƒ ì§€ì¶œì•¡' },
  { id: 'd6', category: 'special', title: 'êµìœ¡ë¹„ ì„¸ì•¡ê³µì œ', limit: 'í•­ëª©ë³„ ìƒì´', desc: 'ëŒ€í•™ìƒ 900ë§Œ, ì´ˆì¤‘ê³  300ë§Œ í•œë„ì…ë‹ˆë‹¤.' },
];

// --- Sub Components ---

const FAQItem = ({ q, a }) => {
  const [isOpen, setIsOpen] = useState(false);
  return (
    <div className="border border-slate-100 rounded-xl overflow-hidden shadow-sm bg-white">
      <button 
        onClick={() => setIsOpen(!isOpen)} 
        className="w-full text-left p-4 hover:bg-slate-50 flex justify-between items-center transition-colors"
      >
        <span className="text-sm font-semibold text-slate-700">Q. {q}</span>
        {isOpen ? <ChevronUp size={16} className="text-slate-400" /> : <ChevronDown size={16} className="text-slate-400" />}
      </button>
      {isOpen && (
        <div className="p-4 bg-slate-50 text-sm text-slate-500 leading-relaxed border-t border-slate-100 whitespace-pre-line animate-in fade-in slide-in-from-top-1">
          {a}
        </div>
      )}
    </div>
  );
};

const ScheduleSection = () => {
  const [showGuide, setShowGuide] = useState(false);
  const steps = [
    { date: '26. 01. 15.(ëª©)', title: 'ê°„ì†Œí™” ì„œë¹„ìŠ¤ ê°œí†µ', desc: 'í™ˆíƒìŠ¤ì—ì„œ ì†Œë“Â·ì„¸ì•¡ê³µì œ ìë£Œ í™•ì¸ ë° ë‚´ë ¤ë°›ê¸°', icon: Search, color: 'text-blue-600', bg: 'bg-blue-50' },
    { date: '26. 01. 20.(í™”)', title: 'í™•ì •ìë£Œ ì œê³µ ì‹œì‘', desc: 'ê°„ì†Œí™” ì„œë¹„ìŠ¤ í™•ì • ìë£Œ ì œê³µ ë° ë¶€ì–‘ê°€ì¡± ë™ì˜ í™•ì¸', icon: CheckCircle, color: 'text-emerald-600', bg: 'bg-emerald-50' },
    { 
      date: '26. 01. 22. ~ 01. 26.', 
      title: 'ë‚˜ì´ìŠ¤ ìë£Œ ì—…ë¡œë“œ', 
      desc: 'PDF ì—…ë¡œë“œ ë° ì¸ì ê³µì œ ë³€ë™ì‚¬í•­ ëŒ€ì¡° í™•ì¸', 
      icon: Upload, 
      color: 'text-indigo-600', 
      bg: 'bg-indigo-50',
      hasButton: true 
    },
    { date: '26. 01. 22. ~ 01. 26.', title: 'PDF ì´ë©”ì¼ ì œì¶œ', desc: 'gogoquick@sen.go.krë¡œ PDF ì „ì†¡ (ë¹„ë°€ë²ˆí˜¸ í•´ì œ)', icon: FileText, color: 'text-purple-600', bg: 'bg-purple-50' },
    { date: '26. 01. 22. ~ 01. 26.', title: 'ìµœì¢… ì„œë¥˜ ë§ˆê°', desc: 'í–‰ì •ì‹¤ ìµœì¢… ì œì¶œ (ê¸°í•œ ë‚´ ë¯¸ì œì¶œ ì‹œ, 2026ë…„ 5ì›” ë³¸ì¸ ì‹ ê³ )', icon: AlertCircle, color: 'text-red-600', bg: 'bg-red-50' },
  ];

  const issuanceLinks = [
    { name: 'ì£¼ë¯¼ë“±ë¡ë“±ë³¸ ë“±', site: 'ì •ë¶€24', url: 'https://www.gov.kr' },
    { name: 'ê±´ë¬¼ë“±ê¸°ë¶€ë“±ë³¸', site: 'ì¸í„°ë„·ë“±ê¸°ì†Œ', url: 'https://www.iros.go.kr' },
    { name: 'ê°œë³„(ê³µë™)ì£¼íƒê°€ê²©í™•ì¸', site: 'ë¶€ë™ì‚°ê³µì‹œê°€ê²©ì•Œë¦¬ë¯¸', url: 'https://www.realtyprice.kr' },
    { name: 'ê°€ì¡±ê´€ê³„ë“±ë¡ë¶€', site: 'ì „ìê°€ì¡±ê´€ê³„ë“±ë¡ì‹œìŠ¤í…œ', url: 'https://efamily.scourt.go.kr' },
  ];

  return (
    <div className="space-y-8">
      <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <h2 className="text-lg font-bold mb-6 flex items-center gap-2 text-slate-800">
          <Calendar className="text-blue-600" /> ì—…ë¬´ ì²˜ë¦¬ ì¼ì •
        </h2>
        <div className="space-y-0 relative before:absolute before:left-[19px] before:top-2 before:bottom-2 before:w-0.5 before:bg-slate-100">
          {steps.map((step, idx) => (
            <div key={idx} className="relative pl-12 pb-8 last:pb-0">
              <div className={`absolute left-0 top-1 w-10 h-10 rounded-full ${step.bg} ${step.color} flex items-center justify-center border-4 border-white z-10 shadow-sm`}>
                <step.icon size={18} />
              </div>
              <div className={`text-xs font-bold mb-1 ${idx >= 2 ? 'text-red-600' : 'text-slate-400'}`}>{step.date}</div>
              <div className="flex flex-col sm:flex-row sm:items-center gap-2 mb-1">
                <h3 className="text-base font-bold text-slate-800">{step.title}</h3>
                {step.hasButton && (
                  <button 
                    onClick={() => setShowGuide(!showGuide)}
                    className="inline-flex items-center gap-1.5 px-3 py-1 bg-blue-600 text-white rounded-lg text-xs font-bold hover:bg-blue-700 shadow-sm transition-all w-fit"
                  >
                    {showGuide ? "ê°€ì´ë“œ ë‹«ê¸°" : "ë°©ë²• ì•ˆë‚´"} {showGuide ? <ChevronUp size={12}/> : <ChevronDown size={12}/>}
                  </button>
                )}
              </div>
              <p className="text-sm text-slate-500 leading-relaxed">{step.desc}</p>
              
              {step.hasButton && showGuide && (
                <div className="mt-6 p-6 bg-slate-50 rounded-2xl border-2 border-blue-100 shadow-inner animate-in fade-in slide-in-from-top-2">
                  <div className="flex items-center gap-2 mb-6 border-b border-blue-100 pb-3">
                    <FileText className="text-blue-600" size={20} />
                    <h4 className="font-black text-slate-800">ë‚˜ì´ìŠ¤ ìë£Œ ì—…ë¡œë“œ ë°©ë²•</h4>
                  </div>
                  <div className="space-y-6">
                    <div className="flex items-start gap-4">
                      <div className="bg-blue-600 text-white px-2.5 py-1 rounded-full text-[10px] font-black flex-shrink-0">STEP 1</div>
                      <div className="space-y-1">
                        <p className="text-sm font-bold text-slate-800">ë‚˜ì´ìŠ¤ ì‹œìŠ¤í…œ ì ‘ì†</p>
                        <a href="https://sen.eduptl.kr/" target="_blank" className="text-xs text-blue-600 underline font-medium break-all">https://sen.eduptl.kr/</a>
                      </div>
                    </div>
                    <div className="flex items-start gap-4">
                      <div className="bg-slate-400 text-white px-2.5 py-1 rounded-full text-[10px] font-black flex-shrink-0">STEP 2</div>
                      <div className="space-y-2">
                        <p className="text-sm font-bold text-slate-800">ë©”ë‰´ ì´ë™ ë° ì¸ì ê³µì œ ë“±ë¡</p>
                        <p className="text-xs text-slate-600 leading-relaxed">
                          ë‚˜ì˜ ë©”ë‰´ <ArrowRight size={10} className="inline mx-1"/> ì—°ë§ì •ì‚° <ArrowRight size={10} className="inline mx-1"/> ì •ì‚°ê³µì œ ìë£Œë“±ë¡ ì´ë™
                        </p>
                        <div className="p-3 bg-blue-100/50 rounded-xl border border-blue-200">
                           <p className="text-[11px] text-blue-800 font-bold leading-relaxed">
                            â€» ì¸ì ê³µì œ ë“±ë¡: ê·€ì† ë…„ë„ 2024ë…„ì„ ì°¸ì¡°(ë‚˜ì´ìŠ¤ í™”ë©´ ìƒë‹¨ ë“œëë°•ìŠ¤ 2024 ì„ íƒ)í•˜ì—¬ 2025ë…„ ë“±ë¡ ì—¬ë¶€ë¥¼ ëŒ€ì¡°í•˜ì„¸ìš”.
                           </p>
                        </div>
                      </div>
                    </div>
                    <div className="flex items-start gap-4 p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                      <div className="bg-indigo-600 text-white px-2.5 py-1 rounded-full text-[10px] font-black flex-shrink-0">STEP 3</div>
                      <div className="space-y-2">
                        <p className="text-sm font-bold text-indigo-900">ìµœì¢… ì„œë¥˜ ì¶œë ¥ ë° ì œì¶œ</p>
                        <p className="text-xs text-indigo-800 leading-relaxed">
                          1. ì†Œë“ê³µì œì‹ ê³ ì„œ(ì„œëª…í•„ìˆ˜) ì œì¶œ<br/>
                          2. ì˜ë£Œë¹„Â·ê¸°ë¶€ê¸ˆÂ·ì¹´ë“œÂ·ì—°ê¸ˆì €ì¶• ìƒì„¸ ëª…ì„¸ì„œ ì¶œë ¥ í›„ ì œì¶œ
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      </div>

      <div className="bg-orange-50 p-6 rounded-2xl border border-orange-100 shadow-sm">
        <h2 className="text-lg font-bold text-orange-900 mb-4 flex items-center gap-2">
          <ShieldAlert className="text-orange-600" /> ì¤‘ë„ ì…ì‚¬ì ë° ì±…ì„ ì•ˆë‚´
        </h2>
        <div className="space-y-4">
          <div className="p-4 bg-white/60 rounded-xl border border-orange-100">
            <p className="text-orange-800 text-sm leading-relaxed">
              <span className="font-bold underline">ì¤‘ë„ ì…ì‚¬ì:</span> ì „ ê·¼ë¬´ì§€ ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦ ì œì¶œ í•„ìˆ˜. ê°„ì†Œí™” ìë£ŒëŠ” <span className="font-bold text-orange-900">ì‹¤ì œ ê·¼ë¬´ ê¸°ê°„ ì›”ë§Œ ì„ íƒ</span>í•˜ì—¬ ë‚´ë ¤ë°›ìœ¼ì„¸ìš”.
            </p>
          </div>
          <div className="p-4 bg-red-50/50 rounded-xl border border-red-100">
            <p className="text-red-900 text-sm font-bold mb-2">ê³¼ë‹¤ ê³µì œ ì „ìˆ˜ì¡°ì‚¬ ì£¼ì˜</p>
            <ul className="text-red-800 text-[13px] space-y-1.5 list-disc pl-4">
              <li>êµ­ì„¸ì²­ í”„ë¡œê·¸ë¨ì„ í†µí•œ ì£¼ìš” í•­ëª© ì „ìˆ˜ì¡°ì‚¬ ì‹¤ì‹œ</li>
              <li>ê³µì œ ì¦ë¹™ ë° ì‹ ê³  ì±…ì„ì€ ì „ì ìœ¼ë¡œ <span className="underline font-black">ì†Œë“ì ë³¸ì¸</span>ì—ê²Œ ìˆìŒ</li>
              <li>ë¶€ë‹¹ ê³µì œ ì ë°œ ì‹œ ê°€ì‚°ì„¸ ë° ì§ì ‘ ìˆ˜ì • ì‹ ê³  í•„ìš”</li>
            </ul>
          </div>
        </div>
      </div>

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-slate-800">
          <Globe className="text-blue-600" /> ì¸í„°ë„· ì¦ë¹™ ì„œë¥˜ ë°œê¸‰
        </h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
          {issuanceLinks.map((link, idx) => (
            <a key={idx} href={link.url} target="_blank" rel="noopener noreferrer" className="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100 hover:border-blue-300 hover:bg-white transition-all group">
              <div>
                <div className="text-xs text-slate-400 font-medium mb-0.5">{link.name}</div>
                <div className="text-sm font-bold text-slate-700 group-hover:text-blue-600">{link.site}</div>
              </div>
              <ExternalLink size={14} className="text-slate-300 group-hover:text-blue-500" />
            </a>
          ))}
        </div>
      </div>
    </div>
  );
};

const DeductionSection = () => {
  const [filter, setFilter] = useState('all');
  const [searchTerm, setSearchTerm] = useState('');

  const allItems = useMemo(() => [
    ...CAUTION_ITEMS.map(i => ({ ...i, type: 'caution' })),
    ...GENERAL_DEDUCTIONS.map(i => ({ ...i, type: i.category }))
  ], []);

  const filteredItems = useMemo(() => {
    return allItems.filter(item => {
      const matchesFilter = filter === 'all' || item.type === filter;
      const matchesSearch = item.title.includes(searchTerm) || item.desc.includes(searchTerm);
      return matchesFilter && matchesSearch;
    });
  }, [filter, searchTerm, allItems]);

  const categories = [
    {id: 'all', label: 'ì „ì²´'}, 
    {id: 'caution', label: 'ğŸš¨ì£¼ì˜ì‚¬í•­'}, 
    {id: 'human', label: 'ì¸ì ê³µì œ'}, 
    {id: 'money', label: 'ì¹´ë“œ/ê¸ˆìœµ'}, 
    {id: 'house', label: 'ì£¼íƒ/ì›”ì„¸'}, 
    {id: 'special', label: 'ì˜ë£Œ/êµìœ¡'}
  ];

  return (
    <div className="space-y-6">
      <div className="flex justify-end">
        <a 
          href="#" 
          className="flex items-center gap-2 px-5 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-md hover:bg-blue-700 transition-all text-sm"
        >
          <FileText size={18} /> ì „ì²´ ì•ˆë‚´ì„œ(PDF) ë³´ê¸°
        </a>
      </div>
      <div className="relative group">
        <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500" size={20} />
        <input 
          type="text" 
          placeholder="ê³µì œ í•­ëª©ì´ë‚˜ ì£¼ì˜ì‚¬í•­ ê²€ìƒ‰..." 
          className="w-full pl-12 pr-4 py-4 bg-white border border-slate-200 rounded-2xl shadow-sm focus:ring-4 focus:ring-blue-100 outline-none transition-all text-base" 
          value={searchTerm} 
          onChange={(e) => setSearchTerm(e.target.value)} 
        />
      </div>
      <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
        {categories.map(cat => (
          <button 
            key={cat.id} 
            onClick={() => setFilter(cat.id)} 
            className={`px-4 py-2 rounded-full text-sm font-bold transition-all border whitespace-nowrap ${
              filter === cat.id ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-500 border-slate-200 hover:border-slate-300'
            }`}
          >
            {cat.label}
          </button>
        ))}
      </div>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {filteredItems.map((item, i) => {
          const isCaution = item.type === 'caution';
          return (
            <div key={i} className={`p-5 rounded-2xl border shadow-sm hover:shadow-md transition-all ${isCaution ? 'border-l-4 border-l-red-500 bg-white' : 'bg-white border-slate-200'}`}>
              <div className="flex justify-between items-start mb-2">
                <div className="flex items-center gap-2">
                  {isCaution && <AlertCircle size={18} className="text-red-600" />}
                  <h3 className={`font-bold ${isCaution ? 'text-red-800' : 'text-slate-800'}`}>{item.title}</h3>
                </div>
                {isCaution && <span className="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full font-black uppercase">CAUTION</span>}
              </div>
              <div className={`text-xs font-bold mb-2 ${isCaution ? 'text-red-500' : 'text-blue-600'}`}>{item.limit}</div>
              <p className={`text-sm leading-snug ${isCaution ? 'text-red-700' : 'text-slate-500'}`}>{item.desc}</p>
            </div>
          );
        })}
      </div>
    </div>
  );
};

const DocumentsSection = ({ onOpenAttachment }) => {
  const [checked, setChecked] = useState({});
  const [printGuide, setPrintGuide] = useState(null);
  const toggle = (id) => setChecked(prev => ({ ...prev, [id]: !prev[id] }));

  const docs = [
    { id: 'd1', name: 'ì†Œë“ê³µì œì‹ ê³ ì„œ', note: 'ë‚˜ì´ìŠ¤ ì¶œë ¥ ë° í•˜ë‹¨ ë³¸ì¸ ì„œëª… (í•„ìˆ˜)', type: 'í•„ìˆ˜' },
    { id: 'd2', name: 'êµ­ì„¸ì²­ ê°„ì†Œí™” PDF', note: 'ë‚˜ì´ìŠ¤ ì—…ë¡œë“œ ë° í–‰ì •ì‹¤ ë©”ì¼ ì œì¶œ', type: 'í•„ìˆ˜' },
    { id: 'd11', name: 'ì „ ê·¼ë¬´ì§€ ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦', note: '2024ë…„ ì¤‘ë„ ì…ì‚¬ì í•œì •', type: 'í•´ë‹¹ì' },
    { id: 'd7', name: 'ì˜ë£Œë¹„ ì§€ê¸‰ëª…ì„¸ì„œ', note: 'ì˜ë£Œë¹„ ê³µì œ ì‹œ ë‚˜ì´ìŠ¤ ì¶œë ¥ ì œì¶œ', type: 'í•´ë‹¹ì', hasPrint: true, path: 'ë‚˜ì´ìŠ¤ > ì—°ë§ì •ì‚° > ë‚˜ì˜ ì˜ë£Œë¹„ì§€ê¸‰ëª…ì„¸ì„œ > ì¶œë ¥' },
    { id: 'd8', name: 'ê¸°ë¶€ê¸ˆ ëª…ì„¸ì„œ', note: 'ê¸°ë¶€ê¸ˆ ê³µì œ ì‹œ ë‚˜ì´ìŠ¤ ì¶œë ¥ ì œì¶œ', type: 'í•´ë‹¹ì', hasPrint: true, path: 'ë‚˜ì´ìŠ¤ > ì—°ë§ì •ì‚° > ë‚˜ì˜ ê¸°ë¶€ê¸ˆì§€ê¸‰ëª…ì„¸ì„œ > ì¶œë ¥' },
    { id: 'd10', name: 'ì‹ ìš©ì¹´ë“œ ë“± ê³µì œëª…ì„¸ì„œ', note: 'ì¹´ë“œ ê³µì œ ì‹œ ë‚˜ì´ìŠ¤ ì¶œë ¥ ì œì¶œ', type: 'í•´ë‹¹ì', hasPrint: true, path: 'ë‚˜ì´ìŠ¤ > ì—°ë§ì •ì‚° > ë‚˜ì˜ ì‹ ìš©ì¹´ë“œëª…ì„¸ì„œ > ì¶œë ¥' },
    { id: 'd3', name: 'ì£¼ë¯¼ë“±ë¡ë“±ë³¸/ê°€ì¡±ê´€ê³„ì¦ëª…ì„œ', note: 'ë¶€ì–‘ê°€ì¡± ë³€ë™ì´ ìˆëŠ” ê²½ìš°', type: 'í•´ë‹¹ì' },
  ];

  return (
    <div className="space-y-8">
      {printGuide && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/60 backdrop-blur-sm">
          <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden border border-slate-100 animate-in zoom-in-95 duration-200">
            <div className="bg-blue-600 p-6 text-white text-center">
              <Calculator size={40} className="mx-auto mb-3 opacity-90" />
              <h3 className="text-xl font-bold">{printGuide.name} ì¶œë ¥ ê²½ë¡œ</h3>
            </div>
            <div className="p-8">
              <div className="flex flex-wrap items-center justify-center gap-2 mb-8">
                {printGuide.path.split(' > ').map((step, i, arr) => (
                  <React.Fragment key={i}>
                    <span className={`px-3 py-1.5 rounded-xl text-sm font-bold border ${i === arr.length - 1 ? 'bg-blue-600 text-white border-blue-600 shadow-sm' : 'bg-slate-50 text-slate-700 border-slate-200'}`}>
                      {step}
                    </span>
                    {i < arr.length - 1 && <ArrowRight size={14} className="text-slate-300" />}
                  </React.Fragment>
                ))}
              </div>
              <div className="bg-orange-50 p-4 rounded-xl border border-orange-100 text-orange-800 text-xs font-bold leading-relaxed text-center">
                â€» ë‚˜ì´ìŠ¤ ì‹œìŠ¤í…œì—ì„œ í•´ë‹¹ ë©”ë‰´ë¡œ ì´ë™ í›„ ìš°ì¸¡ ìƒë‹¨ì˜ [ì¶œë ¥] ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.
              </div>
              <button onClick={() => setPrintGuide(null)} className="w-full mt-6 py-4 bg-slate-800 text-white rounded-2xl font-bold hover:bg-slate-900 transition-colors shadow-lg">í™•ì¸í–ˆìŠµë‹ˆë‹¤</button>
            </div>
          </div>
        </div>
      )}

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <div className="flex justify-between items-start mb-6">
          <div>
            <h2 className="text-lg font-bold flex items-center gap-2 text-slate-800"><FileText className="text-blue-600" /> ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
            <p className="text-sm text-slate-400 mt-1">ì œì¶œí•  ì„œë¥˜ë¥¼ í™•ì¸í•˜ê³  ì²´í¬í•´ ë³´ì„¸ìš”.</p>
          </div>
          <button 
            onClick={onOpenAttachment} 
            className="px-3 py-2 bg-red-600 text-white rounded-lg text-xs font-bold hover:bg-red-700 shadow-sm flex items-center gap-1"
          >
            ìƒì„¸ ê°€ì´ë“œ <ExternalLink size={12} />
          </button>
        </div>
        <div className="space-y-3">
          {docs.map(doc => (
            <div key={doc.id} className={`flex flex-col sm:flex-row sm:items-center justify-between p-4 rounded-xl border transition-all ${checked[doc.id] ? 'bg-slate-50 border-slate-200 opacity-60' : 'bg-white border-slate-100 hover:border-blue-200'}`}>
              <div className="flex items-center gap-3 cursor-pointer flex-grow" onClick={() => toggle(doc.id)}>
                <div className={`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${checked[doc.id] ? 'bg-blue-600 border-blue-600 text-white' : 'border-slate-200'}`}>
                  {checked[doc.id] && <CheckCircle size={14} />}
                </div>
                <div>
                  <div className={`text-sm font-bold ${checked[doc.id] ? 'text-slate-400 line-through' : 'text-slate-800'}`}>{doc.name}</div>
                  <div className="text-xs text-slate-400 leading-snug">{doc.note}</div>
                </div>
              </div>
              <div className="flex items-center gap-2 mt-3 sm:mt-0 ml-9 sm:ml-0">
                {doc.hasPrint && (
                  <button onClick={() => setPrintGuide(doc)} className="text-[10px] bg-slate-800 text-white px-2 py-1 rounded font-bold hover:bg-slate-700 transition-colors">ë‚˜ì´ìŠ¤ ì¶œë ¥ì•ˆë‚´</button>
                )}
                <span className={`text-[10px] font-black uppercase px-1.5 py-0.5 rounded ${doc.type === 'í•„ìˆ˜' ? 'bg-blue-100 text-blue-600' : 'bg-slate-100 text-slate-400'}`}>
                  {doc.type}
                </span>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

// --- Main App ---

export default function App() {
  const [activeTab, setActiveTab] = useState('schedule');
  const [view, setView] = useState('dashboard');
  const [isScrolled, setIsScrolled] = useState(false);

  useEffect(() => {
    const handleScroll = () => setIsScrolled(window.scrollY > 20);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  const tabs = [
    { id: 'schedule', label: 'ì¼ì •/ì ˆì°¨', icon: Calendar },
    { id: 'deductions', label: 'ê³µì œí•­ëª©', icon: Calculator },
    { id: 'documents', label: 'ì œì¶œì„œë¥˜', icon: FileText },
    { id: 'inquiry', label: 'ë¬¸ì˜/FAQ', icon: MessageCircle },
  ];

  if (view === 'attachment') {
    return (
      <div className="min-h-screen bg-slate-50 pb-16">
        <header className="fixed top-0 w-full z-50 bg-white border-b border-slate-200 py-4 shadow-sm">
          <div className="max-w-4xl mx-auto px-6 flex items-center gap-4">
            <button onClick={() => setView('dashboard')} className="p-2 hover:bg-slate-100 rounded-full transition-colors">
              <ArrowLeft size={24} className="text-slate-600" />
            </button>
            <h1 className="text-xl font-bold text-slate-800">ì²¨ë¶€ì„œë¥˜ ìƒì„¸ ê°€ì´ë“œ</h1>
          </div>
        </header>
        <main className="max-w-4xl mx-auto px-4 pt-24">
          <div className="space-y-4">
            {ATTACHMENT_DATA.map((data, i) => (
              <div key={i} className="bg-white rounded-2xl border border-slate-200 p-5 shadow-sm hover:border-blue-300 transition-all">
                <div className="flex justify-between items-start mb-3">
                  <span className="text-[10px] font-black bg-blue-50 text-blue-600 px-2 py-1 rounded-md uppercase tracking-wider">{data.category}</span>
                  {data.note.includes('ê°„ì†Œí™”') && <span className="text-[10px] font-bold text-emerald-600 flex items-center gap-1"><CheckCircle size={12} /> ê°„ì†Œí™” ì œê³µ</span>}
                </div>
                <h3 className="text-lg font-bold text-slate-800 mb-3">{data.item}</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 pt-3 border-t border-slate-50">
                  <div>
                    <p className="text-xs text-slate-400 mb-1 font-bold uppercase">ì¤€ë¹„ ì„œë¥˜</p>
                    <p className="text-sm text-slate-700 font-semibold">{data.docs}</p>
                  </div>
                  <div>
                    <p className="text-xs text-slate-400 mb-1 font-bold uppercase">ë°œê¸‰ì²˜ / ì°¸ê³ </p>
                    <p className="text-sm text-slate-600">{data.issue}</p>
                    {data.note && <p className="text-xs text-blue-500 mt-2 font-medium bg-blue-50/50 p-1.5 rounded-lg inline-block">{data.note}</p>}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </main>
      </div>
    );
  }

  return (
    <div className="min-h-screen flex flex-col bg-slate-50 font-sans text-slate-900">
      <header className={`fixed top-0 w-full z-50 transition-all duration-300 ${isScrolled ? 'bg-white shadow-sm py-3' : 'bg-blue-900 py-6 text-white'}`}>
        <div className="max-w-4xl mx-auto px-6 flex justify-between items-center">
          <h1 className="font-bold flex items-center gap-2 text-xl tracking-tight">
            <Calculator size={24} className={isScrolled ? 'text-blue-600' : 'text-white'} />
            <span>ìƒì•”ì¤‘ 2025 ì—°ë§ì •ì‚°</span>
          </h1>
          <div className={`text-[10px] md:text-xs font-bold px-3 py-1.5 rounded-full shadow-md ${isScrolled ? 'bg-red-100 text-red-600' : 'bg-red-600 text-white'}`}>
            ì œì¶œ ë§ˆê°: 01. 26. (15:30)
          </div>
        </div>
      </header>

      <main className="flex-grow pt-28 pb-16 max-w-4xl mx-auto px-4 w-full">
        <nav className="flex gap-1 mb-8 bg-white p-1.5 rounded-2xl shadow-sm border border-slate-200 overflow-x-auto no-scrollbar">
          {tabs.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-xl text-sm font-semibold transition-all whitespace-nowrap ${
                activeTab === tab.id ? 'bg-blue-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-700'
              }`}
            >
              <tab.icon size={18} />
              {tab.label}
            </button>
          ))}
        </nav>

        <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
          {activeTab === 'schedule' && <ScheduleSection />}
          {activeTab === 'deductions' && <DeductionSection />}
          {activeTab === 'documents' && <DocumentsSection onOpenAttachment={() => setView('attachment')} />}
          {activeTab === 'inquiry' && (
            <div className="space-y-6">
              <div className="bg-gradient-to-br from-blue-700 to-indigo-800 p-8 rounded-3xl text-white shadow-lg text-center">
                <div className="inline-flex p-3 bg-white/10 rounded-2xl mb-4"><MessageCircle size={32} /></div>
                <h2 className="text-2xl font-bold mb-2">ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?</h2>
                <p className="text-blue-100 text-sm font-medium mb-8">ê°€ì¥ ì •í™•í•œ ìƒë‹´ì€ êµ­ì„¸ì²­ ì½œì„¼í„°ë¥¼ ì´ìš©í•˜ì„¸ìš”.</p>
                <div className="flex flex-col sm:flex-row gap-3 justify-center">
                  <a href="https://www.hometax.go.kr" target="_blank" className="bg-white text-blue-700 px-8 py-3.5 rounded-xl font-bold hover:bg-blue-50 transition-colors shadow-sm">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</a>
                  <div className="bg-white/10 px-8 py-3.5 rounded-xl font-bold border border-white/20">ìƒë‹´ì„¼í„° â˜ 126</div>
                </div>
              </div>

              <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h3 className="font-bold text-slate-800 mb-6 flex items-center gap-2"><Info className="text-blue-600" /> ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3>
                <div className="space-y-3">
                  <FAQItem 
                    q="ì˜ë£Œë¹„ ì„¸ì•¡ê³µì œ í•œë„ëŠ”?" 
                    a="ì´ê¸‰ì—¬ì•¡ì˜ 3%ë¥¼ ì´ˆê³¼í•˜ì—¬ ì§€ì¶œí•œ ê¸ˆì•¡ë¶€í„° ëŒ€ìƒì…ë‹ˆë‹¤. ì¼ë°˜ ë¶€ì–‘ê°€ì¡±ì€ ì—° 700ë§Œì› í•œë„ì´ë‚˜ ë³¸ì¸, ì¥ì• ì¸, 65ì„¸ ì´ìƒìëŠ” í•œë„ ì—†ì´ ì „ì•¡ ê³µì œë©ë‹ˆë‹¤." 
                  />
                  <FAQItem 
                    q="ì›”ì„¸ ì„¸ì•¡ê³µì œ ëŒ€ìƒ ì£¼íƒì€?" 
                    a="ì£¼íƒë²•ìƒ ì£¼íƒë¿ë§Œ ì•„ë‹ˆë¼ ì£¼ê±°ìš© ì˜¤í”¼ìŠ¤í…”, ê³ ì‹œì›ë„ í¬í•¨ë©ë‹ˆë‹¤. ë°˜ë“œì‹œ ì „ì…ì‹ ê³ ê°€ ë˜ì–´ ìˆì–´ì•¼ í•˜ë©° ì„ëŒ€ì°¨ê³„ì•½ì„œ ìƒ ì£¼ì†Œì§€ì™€ ì£¼ë¯¼ë“±ë¡ì§€ê°€ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤." 
                  />
                  <FAQItem 
                    q="ì•ˆê²½ êµ¬ì…ë¹„ë„ ê³µì œë˜ë‚˜ìš”?" 
                    a="ë„¤, ì‹œë ¥êµì •ìš© ì•ˆê²½ ë° ì½˜íƒíŠ¸ë Œì¦ˆëŠ” 1ì¸ë‹¹ ì—° 50ë§Œì› í•œë„ë¡œ ì˜ë£Œë¹„ ê³µì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. êµ­ì„¸ì²­ ìë£Œì— ì—†ë‹¤ë©´ ì•ˆê²½ì ì—ì„œ ì˜ìˆ˜ì¦ì„ ë°›ì•„ ì œì¶œí•˜ì„¸ìš”." 
                  />
                </div>
              </div>
            </div>
          )}
        </div>
      </main>

      <footer className="bg-slate-900 text-slate-400 py-12 text-center text-xs">
        <div className="max-w-4xl mx-auto px-6 border-b border-slate-800 pb-8 mb-8 flex justify-center gap-8">
          <a href="https://www.hometax.go.kr" target="_blank" className="hover:text-white transition-colors">êµ­ì„¸ì²­ í™ˆíƒìŠ¤</a>
          <a href="https://sen.eduptl.kr/" target="_blank" className="hover:text-white transition-colors">ë‚˜ì´ìŠ¤ ì‹œìŠ¤í…œ</a>
        </div>
        <p className="font-medium text-slate-500">Â© 2025 ìƒì•”ì¤‘í•™êµ í–‰ì •ì‹¤ ì—°ë§ì •ì‚° ê°€ì´ë“œ</p>
      </footer>
    </div>
  );
}
